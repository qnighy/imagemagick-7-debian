Merge of two patches 69ea5587de17ef89476be47a3cb7f855c0355a74 and 428e68597fa904d0bdc133d878e12acd7dc60fa3 is here.

From 69ea5587de17ef89476be47a3cb7f855c0355a74 Mon Sep 17 00:00:00 2001
From: Dirk Lemstra <dirk@lemstra.org>
Date: Sat, 11 Sep 2021 12:30:44 +0200
Subject: [PATCH] Added missing policy checks in RegisterStaticModules.

From 428e68597fa904d0bdc133d878e12acd7dc60fa3 Mon Sep 17 00:00:00 2001
From: Dirk Lemstra <dirk@lemstra.org>
Date: Sat, 11 Sep 2021 17:01:23 +0200
Subject: [PATCH] Use the correct rights.

--- imagemagick-6.9.11.60+dfsg.orig/magick/static.c
+++ imagemagick-6.9.11.60+dfsg/magick/static.c
@@ -395,7 +395,7 @@ MagickExport MagickBooleanType RegisterS
   */
   assert(module != (const char *) NULL);
   (void) CopyMagickString(module_name,module,MagickPathExtent);
-  rights=ReadPolicyRights;
+  rights=ReadPolicyRights|WritePolicyRights;
   if (IsRightsAuthorized(ModulePolicyDomain,rights,module) == MagickFalse)
     {
       errno=EPERM;
@@ -441,17 +441,24 @@ MagickExport MagickBooleanType RegisterS
 */
 MagickExport void RegisterStaticModules(void)
 {
+  PolicyRights
+    rights;
+
   size_t
     extent;
 
   ssize_t
     i;
 
+  rights=ReadPolicyRights|WritePolicyRights;
   extent=sizeof(MagickModules)/sizeof(MagickModules[0]);
   for (i=0; i < (ssize_t) extent; i++)
   {
     if (MagickModules[i].registered == MagickFalse)
       {
+	if (IsRightsAuthorized(ModulePolicyDomain,rights,
+              MagickModules[i].module) == MagickFalse)
+	  continue;
         (void) (MagickModules[i].register_module)();
         MagickModules[i].registered=MagickTrue;
       }
--- imagemagick-6.9.11.60+dfsg.orig/magick/module.c
+++ imagemagick-6.9.11.60+dfsg/magick/module.c
@@ -1279,7 +1279,7 @@ MagickExport MagickBooleanType OpenModul
   module_info=(ModuleInfo *) GetModuleInfo(module,exception);
   if (module_info != (ModuleInfo *) NULL)
     return(MagickTrue);
-  rights=ReadPolicyRights;
+  rights=ReadPolicyRights|WritePolicyRights;
   if (IsRightsAuthorized(ModulePolicyDomain,rights,module) == MagickFalse)
     {
       errno=EPERM;

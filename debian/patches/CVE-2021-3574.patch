From cd7f9fb7751b0d59d5a74b12d971155caad5a792 Mon Sep 17 00:00:00 2001
From: Cristy <mikayla-grace@urban-warrior.org>
Date: Tue, 13 Apr 2021 21:41:34 -0400
Subject: [PATCH] https://github.com/ImageMagick/ImageMagick/issues/3540

---
 coders/tiff.c | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

--- imagemagick-6.9.11.60+dfsg.orig/coders/tiff.c
+++ imagemagick-6.9.11.60+dfsg/coders/tiff.c
@@ -1332,6 +1332,11 @@ static Image *ReadTIFFImage(const ImageI
         TIFFClose(tiff);
         ThrowReaderException(CorruptImageError,"UnsupportedBitsPerPixel");
       }
+    if (samples_per_pixel > MaxPixelChannels)
+      {
+        TIFFClose(tiff);
+        ThrowReaderException(CorruptImageError,"MaximumChannelsExceeded");
+      }
     if (sample_format == SAMPLEFORMAT_IEEEFP)
       (void) SetImageProperty(image,"quantum:format","floating-point");
     switch (photometric)
@@ -1700,11 +1705,6 @@ static Image *ReadTIFFImage(const ImageI
       }
     if (image->matte != MagickFalse)
       (void) SetImageAlphaChannel(image,OpaqueAlphaChannel);
-    if (samples_per_pixel > MaxPixelChannels)
-      {
-        TIFFClose(tiff);
-        ThrowReaderException(CorruptImageError,"MaximumChannelsExceeded");
-      }
     method=ReadGenericMethod;
     rows_per_strip=(uint32) image->rows;
     if (TIFFGetField(tiff,TIFFTAG_ROWSPERSTRIP,&rows_per_strip) == 1)
